<nav>
  <div class="nav-container">
    <a class="navbar-brand" routerLink="/">
      <img class="navbar-logo" src="assets/logo.png" alt="SaludPlus Logo">
      SaludPlus
    </a>

    <button class="navbar-toggler" (click)="toggleMenu()">
      <i class="fas fa-bars"></i>
    </button>

    <ul class="navbar-nav" [class.show]="menuOpen">
      <!-- Usar *ngFor en lugar de @for si tienes problemas -->
      <li class="nav-item" *ngFor="let item of navItems; trackBy: trackByPath">
        <a class="nav-link" 
           [routerLink]="item.path" 
           routerLinkActive="active"
           *ngIf="hasAccess(item.roles)">
          {{ item.label }}
        </a>
      </li>
    </ul>

    <!-- Menú de usuario -->
    <div class="user-menu" *ngIf="isAuthenticated()">
      <div class="user-menu-trigger" (click)="toggleUserMenu($event)">
        <div class="user-avatar">
          <span>{{ getUserInitial() }}</span>
        </div>
        <div class="user-info">
          <span class="user-name">{{ currentUser?.name }}</span>
          <span class="user-role">{{ getRoleDisplayName(currentUser?.role) }}</span>
        </div>
        <i class="fas fa-chevron-down"></i>
      </div>
      
      <!-- Dropdown del usuario -->
      <div class="user-dropdown" *ngIf="showUserMenu">
        <div class="dropdown-section" *ngIf="currentUser?.role === 'patient'">
          <h6 class="dropdown-heading">Paciente</h6>
          <a routerLink="/patient/dashboard">
            <i class="fas fa-tachometer-alt"></i>
            Mi Dashboard
          </a>
          <a routerLink="/appointments">
            <i class="fas fa-calendar"></i>
            Mis Citas
          </a>
        </div>
        
        <div class="dropdown-section" *ngIf="currentUser?.role === 'doctor'">
          <h6 class="dropdown-heading">Médico</h6>
          <a routerLink="/doctor/dashboard">
            <i class="fas fa-tachometer-alt"></i>
            Mi Dashboard
          </a>
        </div>
        
        <div class="dropdown-section" *ngIf="currentUser?.role === 'admin'">
          <h6 class="dropdown-heading">Administrador</h6>
          <a routerLink="/admin/dashboard">
            <i class="fas fa-tachometer-alt"></i>
            Dashboard Admin
          </a>
          <a routerLink="/admin/users">
            <i class="fas fa-users-cog"></i>
            Gestión de Usuarios
          </a>
        </div>
        
        <!-- ENLACE SIMPLE DE LOGOUT - SIN POPUP -->
        <div class="dropdown-section border-top">
          <a (click)="logout()" class="logout-link">
            <i class="fas fa-sign-out-alt"></i>
            Cerrar Sesión
          </a>
        </div>
      </div>
    </div>

    <!-- Botones de autenticación si no está logueado -->
    <div class="auth-buttons" *ngIf="!isAuthenticated()">
      <a class="btn-login" routerLink="/login">Iniciar Sesión</a>
      <a class="btn-signup" routerLink="/register">Registrarse</a>
    </div>
  </div>

  <!-- POPUP SIMPLE DE LOGOUT - MÁS PARECIDO AL ORIGINAL -->
  <div *ngIf="showLogoutPopup" class="logout-popup-overlay" (click)="cancelLogout()">
    <div class="logout-popup" (click)="$event.stopPropagation()">
      <div class="logout-icon">
        <i class="fas fa-sign-out-alt"></i>
      </div>
      <h3>Cerrar Sesión</h3>
      <p>¿Estás seguro que deseas cerrar sesión?</p>
      <div class="logout-actions">
        <button class="btn-cancel" (click)="cancelLogout()">Cancelar</button>
        <button class="btn-confirm" (click)="executeLogout()">Confirmar</button>
      </div>
    </div>
  </div>
</nav>
