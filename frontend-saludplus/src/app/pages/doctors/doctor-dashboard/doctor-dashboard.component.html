<main class="doctor-dashboard">
  <div class="dashboard-header">
    <div class="content">
      <h1>Bienvenido, {{ doctor.name }}</h1>
      <p>Panel de control - {{ doctor.specialty }}</p>
    </div>
  </div>
  
  <div class="content dashboard-container">
    <div class="dashboard-grid">
      <!-- Columna de estadísticas y calendario -->
      <div class="dashboard-sidebar">
        <!-- Estadísticas -->
        <div class="stats-container">
          <div class="stats-card">
            <h3>Citas</h3>
            <div class="stats-summary">
              <div class="stat-item">
                <span class="stat-number">{{ stats.total }}</span>
                <span class="stat-label">Total</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">{{ stats.scheduled }}</span>
                <span class="stat-label">Agendadas</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">{{ stats.completed }}</span>
                <span class="stat-label">Completadas</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Citas de hoy - CORREGIDO -->
        <div class="today-appointments">
          <h3>Citas para hoy</h3>
          
          @if (todayAppointments.length === 0) {
            <div class="empty-state">
              <p>No hay citas programadas para hoy</p>
            </div>
          }
          
          @if (todayAppointments.length > 0) {
            <ul class="appointment-list">
              @for (apt of todayAppointments; track apt.id) {
                <li class="appointment-item">
                  <div class="appointment-time">{{ apt.time }}</div>
                  <div class="appointment-details">
                    <div class="patient-name">{{ apt.patientName }}</div>
                    <div class="appointment-type">{{ apt.reason }}</div>
                  </div>
                  <div class="appointment-status" [ngClass]="getStatusClass(apt.status)">
                    {{ getStatusText(apt.status) }}
                  </div>
                </li>
              }
            </ul>
          }
        </div>
        
        <!-- Calendario -->
        <div class="calendar-container">
          <div class="calendar-header">
            <button class="calendar-nav" (click)="prevMonth()">
              <i class="fas fa-chevron-left"></i>
            </button>
            <h3>
              {{ currentDate | date:'MMMM yyyy' }}
            </h3>
            <button class="calendar-nav" (click)="nextMonth()">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
          
          <div class="calendar-weekdays">
            <div>Lu</div>
            <div>Ma</div>
            <div>Mi</div>
            <div>Ju</div>
            <div>Vi</div>
            <div>Sa</div>
            <div>Do</div>
          </div>
          
          <div class="calendar-days">
            @for (day of calendarDays; track $index) {
              <div 
                class="calendar-day" 
                [class.other-month]="!day.isCurrentMonth"
                [class.today]="isToday(day.date)"
                [class.has-appointments]="day.hasAppointments"
                (click)="day.isCurrentMonth && selectDate(day.date)"
              >
                {{ day.day }}
                @if (day.hasAppointments) {
                  <span class="appointment-indicator">{{ day.appointments }}</span>
                }
              </div>
            }
          </div>
        </div>
      </div>
      
      <!-- Columna principal con listado de citas -->
      <div class="dashboard-main">
        <div class="appointments-header">
          <h2>Mis Citas</h2>
          
          <div class="filter-section">
            <div class="search-bar">
              <input 
                type="text" 
                placeholder="Buscar por paciente..." 
                [(ngModel)]="searchTerm"
                (input)="onSearchChange()"
              >
              <button class="search-icon">
                <i class="fas fa-search"></i>
              </button>
            </div>
            
            <div class="filter-group">
              <select [(ngModel)]="statusFilter" (change)="onStatusFilterChange()">
                <option value="">Todos los estados</option>
                <option value="scheduled">Agendadas</option>
                <option value="completed">Completadas</option>
                <option value="cancelled">Canceladas</option>
              </select>
              
              <input 
                type="date" 
                [(ngModel)]="dateFilter"
                (change)="onDateFilterChange()"
                [value]="dateFilter"
              >
              
              <button class="reset-button" (click)="resetFilters()">
                <i class="fas fa-sync-alt"></i>
              </button>
            </div>
          </div>
        </div>
        
        <div class="appointments-list">
          @for (appointment of filteredAppointments; track appointment.id) {
            <div class="appointment-card">
              <div class="appointment-header">
                <div class="appointment-patient">
                  <h3>{{ appointment.patientName }}</h3>
                  <p>{{ appointment.patientAge }} años</p>
                </div>
                <div class="appointment-status" [ngClass]="getStatusClass(appointment.status)">
                  {{ getStatusText(appointment.status) }}
                </div>
              </div>
              
              <div class="appointment-details">
                <div class="detail-item">
                  <i class="far fa-calendar-alt"></i>
                  <span>{{ formatDate(appointment.date) }}</span>
                </div>
                <div class="detail-item">
                  <i class="far fa-clock"></i>
                  <span>{{ appointment.time }} hrs</span>
                </div>
                <div class="detail-item">
                  <i class="fas fa-notes-medical"></i>
                  <span>{{ appointment.reason }}</span>
                </div>
              </div>
              
              @if (appointment.notes) {
                <div class="appointment-notes">
                  <h4>Notas de la consulta</h4>
                  <p>{{ appointment.notes }}</p>
                </div>
              }
              
              <div class="appointment-actions">
                @if (appointment.status === 'scheduled') {
                  <button class="action-btn complete-btn" (click)="completeAppointment(appointment.id)">
                    <i class="fas fa-check"></i> Completar
                  </button>
                  <button class="action-btn notes-btn" (click)="addNotes(appointment.id)">
                    <i class="fas fa-sticky-note"></i> Agregar notas
                  </button>
                  <button class="action-btn cancel-btn" (click)="cancelAppointment(appointment.id)">
                    <i class="fas fa-times"></i> Cancelar
                  </button>
                }
                @if (appointment.status === 'completed' && !appointment.notes) {
                  <button class="action-btn notes-btn" (click)="addNotes(appointment.id)">
                    <i class="fas fa-sticky-note"></i> Agregar notas
                  </button>
                }
                <button class="action-btn view-btn">
                  <i class="fas fa-eye"></i> Ver historial
                </button>
              </div>
            </div>
          }
          
          @if (filteredAppointments.length === 0) {
            <div class="no-results">
              <i class="far fa-calendar-times fa-3x"></i>
              <h3>No se encontraron citas</h3>
              <p>No hay citas que coincidan con los filtros aplicados.</p>
              <button class="reset-button-large" (click)="resetFilters()">Mostrar todas las citas</button>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
</main>